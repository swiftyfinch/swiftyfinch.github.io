<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swifty Finch"/><link rel="canonical" href="https://swiftyfinch.github.io/en/2020-06-20-pod-tree"/><meta name="twitter:url" content="https://swiftyfinch.github.io/en/2020-06-20-pod-tree"/><meta name="og:url" content="https://swiftyfinch.github.io/en/2020-06-20-pod-tree"/><title>CocoaPods dependency tree üå≤ | Swifty Finch</title><meta name="twitter:title" content="CocoaPods dependency tree üå≤ | Swifty Finch"/><meta name="og:title" content="CocoaPods dependency tree üå≤ | Swifty Finch"/><meta name="description" content="In the last part I mentioned about one new idea üí°. Recently, I needed to sort out the order of bumping CocoaPods dependencies in a working project. In this post, I will describe how you can do it using Ruby.</p>"/><meta name="twitter:description" content="In the last part I mentioned about one new idea üí°. Recently, I needed to sort out the order of bumping CocoaPods dependencies in a working project. In this post, I will describe how you can do it using Ruby.</p>"/><meta name="og:description" content="In the last part I mentioned about one new idea üí°. Recently, I needed to sort out the order of bumping CocoaPods dependencies in a working project. In this post, I will describe how you can do it using Ruby.</p>"/><!--Yandex.Metrika counter--><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

ym(62530267, "init", {
     clickmap:true,
     trackLinks:true,
     accurateTrackBounce:true
});</script><noscript><div><img src="https://mc.yandex.ru/watch/62530267" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!--/Yandex.Metrika counter--><meta name="yandex-verification" content="57c929529030b8fd"/><meta name="google-site-verification" content="u8NFg-rSs0ZM826TWcHCMQ90RRHRjEk9SpRSbYcB1rQ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/code.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/site.webmanifest"/><meta name="twitter:image" content="https://swiftyfinch.github.io/site/avatar.png"/><meta name="og:image" content="https://swiftyfinch.github.io/site/avatar.png"/></head><body class="item-page"><header><div class="wrapper"><div class="facade"><a class="site-name" href="/en"><img class="avatar" src="/site/avatar.png"/>Swifty Finch</a><div class="icons"><div><a class="icon" href="https://www.instagram.com/swiftyfinch"><img src="/site/networks/instagram_bw.png"/></a></div><div><a class="icon" href="https://twitter.com/swiftyfinch"><img src="/site/networks/twitter_bw.png"/></a></div><div><a class="icon" href="https://medium.com/@swiftyfinch"><img src="/site/networks/medium_bw.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch"><img src="/site/networks/github_bw.png"/></a></div><div><a class="icon" href="https://ekaterinburg.hh.ru/applicant/resumes/view?resume=227c8eb0ff013a445d0039ed1f395a436a494a"><img src="/site/networks/hh_bw.png"/></a></div><div><a class="icon" href="https://www.linkedin.com/in/vyacheslav-khorkov-92b65164"><img src="/site/networks/linkedin_bw.png"/></a></div><div><a class="icon" href="https://www.upwork.com/o/profiles/users/_~01379889e9ed58198c"><img src="/site/networks/upwork_bw.png"/></a></div></div><nav><a href="/ru/2020-06-20-pod-tree"><div>ru</div></a></nav></div></div></header><div class="wrapper"><article><div class="content"><h1><p>CocoaPods dependency tree <img class="reaction" src="/reactions/tree.svg" alt="tree" title="tree"></p></h1><div class="tag-list"><a href="/tags/en-ruby"><div style="background-color: #e86648">ruby</div></a><a href="/tags/en-tools"><div style="background-color: #efac32">tools</div></a><a href="/tags/en-tech"><div style="background-color: #7daf9c">tech</div></a></div><div class="date"><img class="date_icon" src="/reactions/calendar.svg"/><span>20.06.2020</span></div><div class="time_to_read"><img class="time_to_read_icon" src="/reactions/watch.svg"/><span class="time_to_read_text">3 min</span></div><p>In the <a href="/en/2020-06-06-cozy-pod-install-3">last part</a> I mentioned about one new idea <img class="reaction" src="/reactions/idea.svg" alt="idea" title="idea">. Recently, I needed to sort out the order of bumping <strong>CocoaPods</strong> dependencies in a working project. In this post, I will describe how you can do it using <strong>Ruby</strong>.</p><h2 id="aim"><img class="reaction" src="/reactions/aim.svg" alt="aim" title="aim"> <a href="#aim">Goal</a></h2><p>There is a huge project with its <strong>CocoaPods</strong> dependency repository. You need to bump the minor or major version, for example, <strong>Alamofire</strong>.</p><ul><li>Most likely, many other <strong>pods</strong> depend on such a popular library. To bump the version in the project, it is necessary to bump the <strong>Alamofire</strong> version in all dependencies;</li><li>Also, there can be a lot of indirect <strong>Alamofire</strong> dependencies;</li><li>Need to bump dependencies versions in a certain sequence. Otherwise, nothing will come of it;</li><li>Each dependency can have a separate repository. Because of this, an unsuccessful attempt to bump the version may be delayed;</li><li><strong>CocoaPods</strong> shows only one version incompatibility error:</li></ul><pre><code class="terminal"><div class="line"><span class="red-circle">‚Ä¢</span><span class="yellow-circle">‚Ä¢</span><span class="green-circle">‚Ä¢</span> pods install</div><div class="line"><span class="red">In Podfile:</span></div><div class="line"><span class="red">    Core (~&gt; 2.1.4) was resolved to 2.1.4, which depends on Network (~&gt; 2.0.1)</span></div><div class="line"><span class="red">    Authorization (~&gt; 1.1.3) was resolved to 1.1.3, which depends on Network (~&gt; 1.1.0)</span></div></code></pre><h2 id="idea"><img class="reaction" src="/reactions/idea.svg" alt="idea" title="idea"> <a href="#idea">Idea</a></h2><p>Let's write a tiny <strong>utility</strong> and will pass as an argument <strong>the name of the pod</strong>. Then it will figure out in what order to bump the dependencies versions. And in the end, for clarity, this utility will draw a simple tree <img class="reaction" src="/reactions/tree.svg" alt="tree" title="tree">.</p><p>For this we need to do:</p><ul><li>Find all the dependencies (fortunately, they are already in <strong>Podfile.lock</strong>);</li><li>Build a dependency tree;</li><li>Build a subtree which root will be <strong>specified as argument pod</strong>;</li><li>Draw this tree.</li></ul><p>Below I will lightly describe the idea of ‚Äã‚Äãhow such <strong>utility</strong> works. If you still have questions, feel free to ask me on <a href="https://twitter.com/swiftyfinch">Twitter</a>. Also, I do not pretend to have <strong>the optimal solution</strong> and I am open for your <strong>improvement suggestions</strong>.</p><h2 id="ruby"><img class="reaction" src="/reactions/ruby.svg" alt="ruby" title="ruby"> <a href="#ruby">Language</a></h2><p>To solve this problem, I chose <strong>Ruby</strong> language.</p><ul><li>It is easier than <strong>Bash</strong> from last posts;</li><li>The utility can be easily edited and run;</li><li>No need to compile;</li><li>Also, it can be used through <strong>Fastlane</strong> <img class="reaction" src="/reactions/rocket.svg" alt="rocket" title="rocket">.</li></ul><h2 id="parsing"><img class="reaction" src="/reactions/bricks.svg" alt="bricks" title="bricks"> <a href="#parsing">Parsing <strong>Podfile.lock</strong></a></h2><p>First, we need to parse the part of <strong>Podfile.lock</strong>. We skip all dependencies without versions since they do not need to be bumped. All sub dependencies of the form <strong>Moya/Core</strong> are considered as one dependency <strong>Moya</strong>. And then we build a tree.</p><p>Let's look at an easy example. We get the tree with the root <strong>Alamofire</strong>. The root has one child <strong>Moya</strong>. Also, the child knows that his parent <strong>Alamofire</strong>.</p><pre><code class=""><div class="line">PODS:</div><div class="line">  - Moya/Core (<span class="number">13.0.1</span>): <span class="comment"># Consider only the main Moya dependency</div><div class="line">    - Alamofire (~&gt; <span class="number">4.1</span>)</div><div class="line">    - Result <span class="comment"># Skip without version</div><div class="line">  - Alamofire (<span class="number">4.8.2</span>)</div></code></pre><h2 id="steps"><img class="reaction" src="/reactions/map.svg" alt="map" title="map"> <a href="#steps">Step by step</a></h2><p>When the main tree is built, we need to find out a subtree with <strong>the specified pod</strong> in the root. To do this, we first determine <strong>all parents</strong> of the specified pod. Then we will consider <strong>the children of each parent</strong> and try to find <strong>the intersection of the children and the rest of the parents</strong>. If <strong>there is no intersection</strong>, then this means we have no blocking dependencies.</p><p>In other words, we can bump the version from the considered <strong>parent</strong> in the first step. Then <strong>exclude such parents</strong> and repeat the search for the second step. And so on.</p><p>Let's look at a simple example. The parents of <strong>Alamofire</strong>: <strong>Moya</strong> and <strong>Network</strong>. <strong>Network</strong> has a child <strong>Moya</strong> which crosses with parents. And <strong>Moya</strong> has no intersection. So, the first step will contain <strong>Moya</strong> and the second <strong>Network</strong>.</p><pre><code class=""><div class="line">PODS:</div><div class="line">  - Alamofire (<span class="number">1.0.0</span>)</div><div class="line">  - Network (<span class="number">1.0.0</span>):</div><div class="line">    - Moya (= <span class="number">1.0.0</span>)</div><div class="line">    - Alamofire (= <span class="number">1.0.0</span>)</div><div class="line">  - Moya (<span class="number">1.0.0</span>):</div><div class="line">    - Alamofire (= <span class="number">1.0.0</span>)</div></code></pre><h2 id="tree"><img class="reaction" src="/reactions/tree.svg" alt="tree" title="tree"> <a href="#tree">Steps tree</a></h2><p>After found out <strong>all the dependencies for the current step</strong>, need to <strong>consider the children of each dependency</strong>. Find <strong>children</strong> which were determined <strong>in the previous step</strong>. They will become <strong>parents</strong> for <strong>the current dependency</strong>.</p><p>And again let's look at a small example. We will use the data from the section above. <strong>Alamofire</strong> at the root. Then at the first step, we have <strong>Moya</strong>, because it has child <strong>Alamofire</strong> and it was at the last step (in the root). Then <strong>Network</strong>, because it has two children <strong>Alamofire</strong> and <strong>Moya</strong>. But only <strong>Moya</strong> was in the previous step.</p><pre><code class=""><div class="line">Alamofire <span class="number">‚û°Ô∏é</span> Moya <span class="number">‚û°Ô∏é</span> Network</div></code></pre><h2 id="draw"><img class="reaction" src="/reactions/draw.svg" alt="draw" title="draw"> <a href="#draw">Let's draw</a></h2><p>The main task has already been solved, but it remains to draw a tree. Let's <strong>go down from the root</strong>. Look at each child and start from it <strong>recursively</strong>. And also add some paints.</p><pre><code class=""><div class="line"><span class="red-circle">‚Ä¢</span> Alamofire</div><div class="line">  <span class="yellow-circle">‚Ä¢</span> Moya</div><div class="line">    <span class="green-circle">‚Ä¢</span> Network</div></code></pre><h2 id="usage"><img class="reaction" src="/reactions/rocket.svg" alt="rocket" title="rocket"> <a href="#usage">How to use it?</a></h2><p>I posted the final solution on <a href="https://gist.github.com/swiftyfinch/7cfab946a17ae1998cd4d6c62cdf7a33">GithubGist</a>. Also I added detailed usage help.</p><pre><code class="terminal"><div class="line"><span class="red-circle">‚Ä¢</span><span class="yellow-circle">‚Ä¢</span><span class="green-circle">‚Ä¢</span> ruby PodTree.rb help</div><div class="line"><span class="green">Tiny utility for visualise Pod dependencies tree.</div><div class="line"><span class="green">Skips subspecs and pods without versions.</div><div class="line">Help options: ["-h", "--help", "help"]</div><div class="line"><span class="yellow">  ‚Ä¢ 1st argument will be used as root Pod</span></div><div class="line"><span class="yellow">  ‚Ä¢ 2nd one is path to Podfile (pwd by default)</span></div><div class="line"></div>
<div class="line"><span class="yellow">ruby PodTree.rb A Podfile.lock</span></div><div class="line"><span class="green">Podfile.lock:         Output:</span></div><div class="line">- A (1.0.0)           <span class="red-circle">‚Ä¢</span> A</div><div class="line">- B (1.0.0):            <span class="yellow-circle">‚Ä¢</span> D</div><div class="line">  - A (= 1.0.0)           <span class="green-circle">‚Ä¢</span> C</div><div class="line">  - C (= 1.0.0)             <span class="blue-circle">‚Ä¢</span> B</div><div class="line">  - D (= 1.0.0)           <span class="green-circle">‚Ä¢</span> E</div><div class="line">- C (1.0.0):</div><div class="line">  - A (= 1.0.0)</div><div class="line">  - D (= 1.0.0)</div><div class="line">- D (1.0.0):</div><div class="line">  - A (= 1.0.0)</div><div class="line">- E (1.0.0):</div><div class="line">  - A (= 1.0.0)</div><div class="line">  - D (= 1.0.0)</div></code></pre><h2 id="result"><img class="reaction" src="/reactions/party.svg" alt="party" title="party"> <a href="#result">Result</a></h2><ul><li>The problem was solved;</li><li>A tree <img class="reaction" src="/reactions/tree.svg" alt="tree" title="tree"> <s>planted</s> painted;</li><li>I was glad to share this solution with you;</li><li><a href="https://twitter.com/swiftyfinch">Twit me</a> if you have questions or improvement ideas.</li></ul><p>Thank you all for your attention! I hope you enjoyed the post. And that's all for now. <br>I'm starting to play <strong>Last of Us 2</strong> and going to watch <strong>WWDC 2020</strong> soon.</p><p><br></p><p>üí¨ Please, leave some feedback in <strong>Twitter</strong> post.<br>It will help me improve posts and continue to publish new ones.</p><blockquote class="twitter-tweet" data-lang="en" data-dnt="true"><p lang="en" dir="ltr"><img class="reaction" src="/reactions/rocket.svg" alt="rocket" title="rocket">CocoaPods dependency tree<img class="reaction" src="/reactions/tree.svg" alt="tree" title="tree"><a href="https://twitter.com/hashtag/cocoapods?src=hash&amp;ref_src=twsrc%5Etfw">#cocoapods</a> <a href="https://twitter.com/hashtag/ruby?src=hash&amp;ref_src=twsrc%5Etfw">#ruby</a> <a href="https://twitter.com/hashtag/tools?src=hash&amp;ref_src=twsrc%5Etfw">#tools</a> <a href="https://twitter.com/hashtag/tech?src=hash&amp;ref_src=twsrc%5Etfw">#tech</a> <a href="https://twitter.com/hashtag/tree?src=hash&amp;ref_src=twsrc%5Etfw">#tree</a><a href="https://t.co/R9Ymre44W1">https://t.co/R9Ymre44W1</a> <a href="https://t.co/MfRM5QvNcx">pic.twitter.com/MfRM5QvNcx</a></p>&mdash; –ù—É –°–ª–∞–∞–∞–∞–≤–∞ (@swiftyfinch) <a href="https://twitter.com/swiftyfinch/status/1274762318631571457?ref_src=twsrc%5Etfw">June 21, 2020</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><footer><a class="home" href="/en" title="Go Home"><img src="/reactions/home.svg"/></a><p>¬© 2020. All rights reserved.</p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p></footer></body></html>