<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta property="og:site_name" content="Swifty Finch"/><link rel="canonical" href="https://swiftyfinch.github.io/en/2020-05-31-cozy-pod-install-2"/><meta name="twitter:url" content="https://swiftyfinch.github.io/en/2020-05-31-cozy-pod-install-2"/><meta property="og:url" content="https://swiftyfinch.github.io/en/2020-05-31-cozy-pod-install-2"/><title>(p.2) Cozy pod install 🌿 | Swifty Finch</title><meta name="twitter:title" content="(p.2) Cozy pod install 🌿 | Swifty Finch"/><meta property="og:title" content="(p.2) Cozy pod install 🌿 | Swifty Finch"/><meta name="description" content="In last part, we cut down the bundle exec pod install command to pods install. Just one letter more than the usual  pod install. And this time let's see what other upset moments happen while using this command."/><meta name="twitter:description" content="In last part, we cut down the bundle exec pod install command to pods install. Just one letter more than the usual  pod install. And this time let's see what other upset moments happen while using this command."/><meta property="og:description" content="In last part, we cut down the bundle exec pod install command to pods install. Just one letter more than the usual  pod install. And this time let's see what other upset moments happen while using this command."/><!--Yandex.Metrika counter--><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

ym(62530267, "init", {
     clickmap:true,
     trackLinks:true,
     accurateTrackBounce:true
});</script><noscript><div><img src="https://mc.yandex.ru/watch/62530267" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!--/Yandex.Metrika counter--><meta name="yandex-verification" content="57c929529030b8fd"/><meta name="google-site-verification" content="u8NFg-rSs0ZM826TWcHCMQ90RRHRjEk9SpRSbYcB1rQ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/code.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/site.webmanifest"/><meta name="twitter:image" content="https://swiftyfinch.github.io/site/avatar.png"/><meta property="og:image" content="https://swiftyfinch.github.io/site/avatar.png"/></head><body class="item-page"><header><div class="wrapper"><div class="facade"><a class="site-name" href="/en"><img class="avatar" src="/site/avatar.png"/>Swifty Finch</a><div class="icons"><div><a class="icon" href="https://github.com/swiftyfinch"><img src="/site/networks/github.png"/></a></div><div><a class="icon" href="https://www.linkedin.com/in/vyacheslav-khorkov-92b65164"><img src="/site/networks/linkedin.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/rugby"><img src="/site/networks/rugby.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/xtree"><img src="/site/networks/xtree.png"/></a></div><div><a class="icon" href="https://t.me/ural_finch"><img src="/site/networks/telegram.png"/></a></div></div><nav><a href="/ru/2020-05-31-cozy-pod-install-2"><div>ru</div></a></nav></div></div></header><div class="wrapper"><article><div class="content"><h1><p>(p.2) Cozy pod install <img class="reaction" src="/reactions/herb.svg" alt="herb.svg" title="herb.svg"></p></h1><div class="tag-list"><a href="/tags/bash"><div style="background-color: #e86648">bash</div></a><a href="/tags/tools"><div style="background-color: #efac32">tools</div></a><a href="/tags/tech"><div style="background-color: #7daf9c">tech</div></a></div><div class="date"><img class="date_icon" src="/reactions/calendar.svg"/><span>31.05.2020</span></div><div class="time_to_read"><img class="time_to_read_icon" src="/reactions/watch.svg"/><span class="time_to_read_text">5 min</span></div><p>In <a href="/en/2020-05-23-cozy-pod-install">last part</a>, we cut down the <strong>bundle exec pod install</strong> command to <strong>pods install</strong>. Just one letter more than the usual <strong> pod install</strong>. And this time let's see what other upset moments happen while using this command.</p><p>Let's describe which scenarios of using <strong>pod install</strong> exist. But first, need to figure out which files are involved in dependency resolving when running this command:</p><ul><li><strong>Podfile</strong> describes the necessary dependencies;</li><li><strong>Podfile.lock</strong> describes the installed dependencies;</li><li><strong>Manifest.lock</strong> a local copy of the <strong>Podfile.lock</strong>. Located in the <strong>Pods</strong> folder.</li></ul><h2 id="new"><img class="reaction" src="/reactions/rocket.gif" alt="rocket.gif" title="rocket.gif"> <a href="#new">Scenario 1: New project</a></h2><p>A new project without <strong>CocoaPods</strong>. Call <strong>pod init</strong>, then describe the dependencies in <strong>Podfile</strong>. Finally, call <strong>pod install</strong> for the first time. At the time of the call <strong>CocoaPods</strong> is looking that there is no <strong>Podfile.lock</strong> file yet. Then installs all the dependencies described in <strong>Podfile</strong>. In the end, <strong>Podfile.lock</strong> and its local copy <strong>Manifest.lock</strong> are created.</p><h2 id="change"><img class="reaction" src="/reactions/edit.svg" alt="edit.svg" title="edit.svg"> <a href="#change">Scenario 2: Changed something</a></h2><p>In this scenario, we change <strong>Podfile</strong> or <strong>*. podspec</strong> for the local dependency. Maybe we added a new dependency or changed the description. When called, <strong>Podfile.lock</strong> and its local copy <strong>Manifest.lock</strong> are updated.</p><p>In my opinion, there is nothing to optimize in the first two scenarios. But we would not break them with our future optimization.</p><h2 id="sync"><img class="reaction" src="/reactions/sync.svg" alt="sync.svg" title="sync.svg"> <a href="#sync">Scenario 3: Sync</a></h2><p>Download a new project or new changes from <strong>git</strong> where <strong>Podfile.lock</strong> already exists. When the command is called, the dependencies from two files are usually compared: <strong>Podfile.lock</strong> and your local file <strong>Manifest.lock</strong>. Dependencies from <strong>Podfile.lock</strong> are updated and copied to <strong>Manifest.lock</strong>.</p><p>Everything is as usual, but there is one caveat. The project will be regenerated even if <strong>Podfile.lock</strong> and <strong>Manifest.lock</strong> are the same. In other words, if <strong>pod install</strong> was not needed, and you called it, then it will not work instantly. And will not say that it was not needed at all now.</p><p>On my working project, this unnecessary run takes a <strong>full minute</strong>. Maybe this is not so much, but obviously, this time can be used more usefully.</p><h2 id="xcode"><img class="reaction" src="/reactions/xcode.svg" alt="xcode.svg" title="xcode.svg"> <a href="#xcode">Solving the problem in <strong>Xcode</strong></a></h2><p>A solution to this problem is already in <strong>Build Phases</strong> of the project generated using <strong>CocoaPods</strong>. That is. You just always need to first try to build the project, and then call <strong>pod install</strong> in the terminal.</p><img src="/posts/2020-05-31-cozy-pod-install-2/manifest.png"/><p>In this script, <strong>Podfile.lock</strong> and <strong>Manifest.lock</strong> are compared using the <strong>diff</strong> command. And if they are not equal, then <strong>Xcode</strong> will have a familiar error <strong>The sandbox is not in sync with the Podfile.lock…</strong></p><p>In general, this is a great solution, but what if you still forgot? Opened the terminal and called first the unnecessary <strong>pod install</strong>? Or your project is huge and working slowly?</p><p><strong>Just wait a minute!</strong> - you would say. But I can’t wait. Moreover, this is not the last thing I would like to make more convenient in <strong>pod install</strong>. And it's so magnetic work with <strong>Bash</strong>.</p><h2 id="blackjack"><img class="reaction" src="/reactions/bender.svg" alt="bender.svg" title="bender.svg"> <a href="#blackjack">Our own <strong>pod install</strong> with blackjack</a></h2><p>Why not? Well, no way. It is for a very long time and senseless. And also need to support the release of new versions that can break everything.</p><p>But why not just write a small wrapper over <strong>CocoaPods</strong> and add a check before calling <strong>pod install</strong>, as is done in <strong>Xcode</strong>? Can we?</p><p>All that we will do needs to be placed in your <strong>.bash_profile</strong>, as we did in the <a href="/en/2020-05-23-cozy-pod-install">last part</a>. First, create a simple wrapper function <strong>pods_install</strong>. With this function, we can add a check before calling <strong>pod install</strong>. And much more.</p><pre><code class="block"><div class="line"><span class="keyword">function</span> pods_install() {</div><div class="line">    <span class="comment"># TODO: Add compare Podfile.lock and Manifest.lock</span></div><div class="line">    <span class="method">bundle exec</span> pod install <span class="string">"$@"</span></div><div class="line">}</div></code></pre><p>Then we need to make sure that everything works exactly as before. And will not break something. Instead of <strong>alias</strong> from the previous post, we will create the <strong>pods</strong> function. If the argument <strong>install</strong> is passed to this function, we will throw away this argument and call <strong>pods_install</strong>. Otherwise, we just replace <strong>pods</strong> with <strong>bundle exec pod</strong>.</p><pre><code class="block"><div class="line"><span class="comment"># Instead of the alias from the last post</span></div><div class="line"><span class="keyword">function</span> pods() {</div><div class="line">    <span class="keyword">case</span> <span class="call">$*</span> <span class="keyword">in</span></div><div class="line">        install ) <span class="keyword">shift</span> <span class="number">1</span>; pods_install <span class="string">"$@"</span> ;;</div><div class="line">        <span class="call">*</span> ) <span class="keyword">command</span> <span class="method">bundle exec</span> pod <span class="string">"$@"</span> ;;</div><div class="line">    <span class="keyword">esac</span></div><div class="line">}</div></code></pre><p>So far so good. Everything still works as before. Remains to add the check to <strong>pods_install</strong>. I copied the code from <strong>Xcode</strong> and cut down it as much as possible for simplicity. The <strong>diff</strong> command is used for comparison. The command log is not output to the terminal. After execution, we check the value of the result of the command. If it is zero the files are the same. Otherwise, we exit the function and skip <strong>pod install</strong>.</p><pre><code class="block"><div class="line"><span class="keyword">function</span> pods_install() {</div><div class="line">    <span class="method">diff</span> <span class="string">"Podfile.lock" "Pods/Manifest.lock"</span> &gt; <span class="call">/dev/null</span></div><div class="line">    <span class="keyword">if</span> [ <span class="call">$?</span> == <span class="number">0</span> ] ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">return</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">    <span class="method">bundle exec</span> pod install <span class="string">"$@"</span></div><div class="line">}</div></code></pre><h2 id="bug"><img class="reaction" src="/reactions/bug.svg" alt="bug.svg" title="bug.svg"> <a href="#bug">Debug</a></h2><p>Let's check all the scenarios:</p><ul><li>New project. When called, we get <strong>diff: Podfile.lock: No such file or directory</strong>. Then <strong>pod install</strong> is executed and <strong>Podfile.lock</strong> is created. That's OK;</li></ul><ul><li>Sync. If <strong>Podfile.lock</strong> was not changed in <strong>git</strong>, then <strong>pod install</strong> is not called. Else the local <strong>Manifest.lock</strong> is different from <strong>Podfile.lock</strong>, so <strong>pod install</strong> is called. Jobs done;</li></ul><ul><li>We changed something in <strong>Podfile</strong> or <strong>*.podspec</strong> for the local dependency. Nothing happens when calling <strong>pod install</strong>. Because <strong>Podfile.lock</strong> and <strong>Manifest.lock</strong> remain the same. This is bad, we have to figure out how can force <strong>pod install</strong> to run. That's buggy.</li></ul><h2 id="force"><img class="reaction" src="/reactions/force.svg" alt="force.svg" title="force.svg"> <a href="#force">Force <strong>pod install</strong></a></h2><p>The easiest way to fix the buggy scenario is to add a new mode. In this mode, we will always call <strong>pod install</strong> without checking <strong>Podfile.lock</strong> and <strong>Manifest.lock</strong>. We always know when we added a new dependency or changed local <strong>*.podspec</strong>.</p><p>Let's change the <strong>pods_install</strong> function first. For simplicity, we will check only the first argument. If it is <strong>-f</strong>, then skip the step where we compare <strong>Podfile.lock</strong> and <strong>Manifest.lock</strong>. Otherwise, skip the first argument and pass everything else to <strong>pod install</strong>.</p><pre><code class="block"><div class="line"><span class="keyword">function</span> pods_install() {</div><div class="line">    <span class="comment"># Check the first argument and if it is -f </span></div><div class="line">    <span class="keyword">if</span> [ <span class="call">"$1"</span> == <span class="string">"-f"</span> ] ; <span class="keyword">then</span></div><div class="line">        <span class="comment"># Throw it away so as not to pass it to pod install</span></div><div class="line">        <span class="keyword">shift</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="comment"># Otherwise all as before</span></div><div class="line">        <span class="method">diff</span> <span class="string">"Podfile.lock" "Pods/Manifest.lock"</span> &gt; <span class="call">/dev/null</span></div><div class="line">        <span class="keyword">if</span> [ <span class="call">$?</span> == <span class="number">0</span> ] ; <span class="keyword">then</span></div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">    <span class="method">bundle exec</span> pod install <span class="string">"$@"</span></div><div class="line">}</div></code></pre><p>It remains to slightly update the <strong>pods</strong> function. Again, for simplicity, I decided to use the <strong>pods install!</strong> command. It is slightly shorter to use and easier to implement. In the function, we check if the argument is <strong>install!</strong>, when <strong>pods_install</strong> is called, we pass the first argument <strong>-f</strong>, and then the remaining arguments. The rest is unchanged.</p><pre><code class="block"><div class="line"><span class="keyword">function</span> pods() {</div><div class="line">    <span class="keyword">case</span> <span class="call">$*</span> <span class="keyword">in</span></div><div class="line">        install! ) <span class="keyword">shift</span> <span class="number">1</span>; pods_install -f <span class="string">"$@"</span> ;;</div><div class="line">        install ) <span class="keyword">shift</span> <span class="number">1</span>; pods_install <span class="string">"$@"</span> ;;</div><div class="line">        <span class="call">*</span> ) <span class="keyword">command</span> <span class="method">bundle exec</span> pod <span class="string">"$@"</span> ;;</div><div class="line">    <span class="keyword">esac</span></div><div class="line">}</div></code></pre><h2 id="message"><img class="reaction" src="/reactions/loudspeaker.svg" alt="loudspeaker.svg" title="loudspeaker.svg"> <a href="#message">Add message</a></h2><p>Add a small message that this time there were no changes and <strong>pod install</strong> was not called. The final version will look like this.</p><pre><code class="block"><div class="line"><span class="keyword">function</span> pods_install() {</div><div class="line">    <span class="keyword">if</span> [ <span class="call">"$1"</span> == <span class="string">"-f"</span> ] ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">shift</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="method">diff</span> <span class="string">"Podfile.lock" "Pods/Manifest.lock"</span> &gt; <span class="call">/dev/null</span></div><div class="line">        <span class="keyword">if</span> [ <span class="call">$?</span> == <span class="number">0</span> ] ; <span class="keyword">then</span></div><div class="line">            <span class="keyword">echo</span> <span class="string">"<img class="reaction" src="/reactions/party.png" alt="party.png" title="party.png"> Everything is up to date."</span></div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">    <span class="method">bundle exec</span> pod install <span class="string">"$@"</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">function</span> pods() {</div><div class="line">    <span class="keyword">case</span> <span class="call">$*</span> <span class="keyword">in</span></div><div class="line">        install! ) <span class="keyword">shift</span> <span class="number">1</span>; pods_install -f <span class="string">"$@"</span> ;;</div><div class="line">        install ) <span class="keyword">shift</span> <span class="number">1</span>; pods_install <span class="string">"$@"</span> ;;</div><div class="line">        <span class="call">*</span> ) <span class="keyword">command</span> <span class="method">bundle exec</span> pod <span class="string">"$@"</span> ;;</div><div class="line">    <span class="keyword">esac</span></div><div class="line">}</div></code></pre><h2 id="result"><img class="reaction" src="/reactions/party.png" alt="party.png" title="party.png"> <a href="#result">Result</a></h2><ul><li>In this part, we made <strong>pod install</strong> a little more convenient;</li><li>Prepared <strong>Bash</strong> function for new enhancements;</li><li>And didn’t break anything (but I'm not sure).</li></ul><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> pods install</div><div class="line"><img class="reaction" src="/reactions/party.png" alt="party.png" title="party.png"> Everything is up to date.</div>
<div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> pods install!</div><div class="line">Analyzing dependencies</div><div class="line">Downloading dependencies</div><div class="line"><span class="green">Installing Alamofire (5.2.0)</span></div><div class="line"><span class="green">Pod installation complete!</span></div><div class="line"><span class="green">There are 2 dependencies from the Podfile and 2 total pods installed.</span></div></code></pre><p>In the <a href="/en/2020-06-06-cozy-pod-install-3">next part</a> we will try to make <strong>pod install</strong> even more convenient. We will learn how to calmly switch to <s>drink coffee and watch memes</s> other important tasks, and not to constantly check the terminal in the hope that everything is already installed.</p><p><br></p><p>💬 Please, leave some feedback in <strong>Twitter</strong> post.<br>It will help me improve posts and continue to publish new ones.</p><blockquote class="twitter-tweet" data-lang="en" data-dnt="true"><p lang="en" dir="ltr">(p.2) Cozy pod install <img class="reaction" src="/reactions/herb.svg" alt="herb.svg" title="herb.svg"><a href="https://twitter.com/hashtag/ios?src=hash&amp;ref_src=twsrc%5Etfw">#ios</a> <a href="https://twitter.com/hashtag/cocoapods?src=hash&amp;ref_src=twsrc%5Etfw">#cocoapods</a> <a href="https://twitter.com/hashtag/bash?src=hash&amp;ref_src=twsrc%5Etfw">#bash</a> <a href="https://twitter.com/hashtag/tools?src=hash&amp;ref_src=twsrc%5Etfw">#tools</a><a href="https://t.co/p5gA7SFON6">https://t.co/p5gA7SFON6</a> <a href="https://t.co/94nWK291Sw">pic.twitter.com/94nWK291Sw</a></p>&mdash; Ну Слаааава (@swiftyfinch) <a href="https://twitter.com/swiftyfinch/status/1272183521130557445?ref_src=twsrc%5Etfw">June 14, 2020</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><footer><a class="home" href="/en" title="Go Home"><img src="/reactions/home.svg"/></a><p>© 2025. All rights reserved.</p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p></footer></body></html>