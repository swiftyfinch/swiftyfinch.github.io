<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swifty Finch"/><link rel="canonical" href="https://swiftyfinch.github.io/en/2020-06-06-cozy-pod-install-3"/><meta name="twitter:url" content="https://swiftyfinch.github.io/en/2020-06-06-cozy-pod-install-3"/><meta name="og:url" content="https://swiftyfinch.github.io/en/2020-06-06-cozy-pod-install-3"/><title>(p.3) Cozy pod install 🌿 | Swifty Finch</title><meta name="twitter:title" content="(p.3) Cozy pod install 🌿 | Swifty Finch"/><meta name="og:title" content="(p.3) Cozy pod install 🌿 | Swifty Finch"/><meta name="description" content="In the last part, we wrote a small wrapper over the regular CocoaPods and figure out how to skip unnecessary calls. In this part, let's try to automate a couple of interesting cases. The main goal is to run the pods install command and switch to other tasks while it is running."/><meta name="twitter:description" content="In the last part, we wrote a small wrapper over the regular CocoaPods and figure out how to skip unnecessary calls. In this part, let's try to automate a couple of interesting cases. The main goal is to run the pods install command and switch to other tasks while it is running."/><meta name="og:description" content="In the last part, we wrote a small wrapper over the regular CocoaPods and figure out how to skip unnecessary calls. In this part, let's try to automate a couple of interesting cases. The main goal is to run the pods install command and switch to other tasks while it is running."/><!--Yandex.Metrika counter--><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

ym(62530267, "init", {
     clickmap:true,
     trackLinks:true,
     accurateTrackBounce:true
});</script><noscript><div><img src="https://mc.yandex.ru/watch/62530267" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!--/Yandex.Metrika counter--><meta name="yandex-verification" content="57c929529030b8fd"/><meta name="google-site-verification" content="u8NFg-rSs0ZM826TWcHCMQ90RRHRjEk9SpRSbYcB1rQ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/code.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/site.webmanifest"/><meta name="twitter:image" content="https://swiftyfinch.github.io/site/avatar.png"/><meta name="og:image" content="https://swiftyfinch.github.io/site/avatar.png"/></head><body class="item-page"><header><div class="wrapper"><div class="facade"><a class="site-name" href="/en"><img class="avatar" src="/site/avatar.png"/>Swifty Finch</a><div class="icons"><div><a class="icon" href="https://github.com/swiftyfinch"><img src="/site/networks/github.png"/></a></div><div><a class="icon" href="https://www.linkedin.com/in/vyacheslav-khorkov-92b65164"><img src="/site/networks/linkedin.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/rugby"><img src="/site/networks/rugby.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/xtree"><img src="/site/networks/xtree.png"/></a></div><div><a class="icon" href="https://t.me/ural_finch"><img src="/site/networks/telegram.png"/></a></div></div><nav><a href="/ru/2020-06-06-cozy-pod-install-3"><div>ru</div></a></nav></div></div></header><div class="wrapper"><article><div class="content"><h1><p>(p.3) Cozy pod install <img class="reaction" src="/reactions/herb.svg" alt="herb.svg" title="herb.svg"></p></h1><div class="tag-list"><a href="/tags/bash"><div style="background-color: #e86648">bash</div></a><a href="/tags/tools"><div style="background-color: #efac32">tools</div></a><a href="/tags/tech"><div style="background-color: #7daf9c">tech</div></a></div><div class="date"><img class="date_icon" src="/reactions/calendar.svg"/><span>06.06.2020</span></div><div class="time_to_read"><img class="time_to_read_icon" src="/reactions/watch.svg"/><span class="time_to_read_text">3 min</span></div><p>In the <a href="/en/2020-05-31-cozy-pod-install-2">last part</a>, we wrote a small wrapper over the regular <strong>CocoaPods</strong> and figure out how to skip unnecessary calls. In this part, let's try to automate a couple of interesting cases. The main goal is to run the <strong>pods install</strong> command and switch to other tasks while it is running.</p><h2 id="bundler"><img class="reaction" src="/reactions/toolbox.svg" alt="toolbox.svg" title="toolbox.svg"> <a href="#bundler">Bundler</a></h2><p>The first drawback is that sometimes <strong>Bundler</strong> informs us that it would be nice to call <strong>bundler install</strong> before calling <strong>pods install</strong>. Usually, this is happening because someone from other developers changed <strong>Gemfile</strong> and then you pulled new changes from <strong>git</strong>.</p><p>But why that inconvenient? Because you first need to run <strong>pods install</strong>. Then notice that you need to call <strong>bundler install</strong>. Call it and wait for completion. And finally, call <strong>pods install</strong> again. Not great, but not terrible.</p><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> pods install</div><div class="line"><span class="red">Could not find gem 'cocoapods (= 1.9.2)' in any of the gem sources listed in your Gemfile.</span></div><div class="line"><span class="yellow">Run `bundle install` to install missing gems.</span></div></code></pre><h2 id="out_of_date"><img class="reaction" src="/reactions/calendar2.svg" alt="calendar2.svg" title="calendar2.svg"> <a href="#out_of_date">Out of date source repos</a></h2><p>The second drawback is that sometimes when calling <strong>pods install</strong> you may get an error from <strong>CocoaPods</strong> related to the irrelevance of the local dependency repository. When does this happen? Usually when a dependency has a new version and it is listed in <strong>Podfile</strong>, but you do not have this version locally yet.</p><p>In this case, <strong>CocoaPods</strong> offers some options:</p><ul><li><strong>pod repo update</strong> and then <strong>pod install</strong>;</li><li><strong>pod install --repo-update</strong> the same as above, but in one command.</li></ul><p>In other words, we need to update the local dependency repository, and then call <strong>pods install</strong>. As same as the last drawback, it is like a waste of time. Besides, usually updating the local repository takes much longer.</p><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> pods install</div><div class="line">Analyzing dependencies</div><div class="line"><span class="red">[!] CocoaPods could not find compatible versions for pod "Frog":</span></div><div class="line"><span class="red">  In Podfile:</span></div><div class="line"><span class="red">    Frog (~> 1.3.0)</span></div>
<div class="line"><span class="red">None of your spec sources contain a spec satisfying the dependency: `Frog (~> 1.3.0)`.</span></div>
<div class="line"><span class="red">You have either:</span></div><div class="line"><span class="red"> * out-of-date source repos which you can update with `pod repo update`
or with `pod install --repo-update`.</span></div><div class="line"><span class="red"> * mistyped the name or version.</span></div><div class="line"><span class="red"> * not added the source repo that hosts the Podspec to your Podfile.</span></div></code></pre><p>It is worth noting that starting with <strong>CocoaPods 1.8 Beta</strong> this is no longer a problem. Now <strong>cdn</strong> is used by default and you no longer need to store the local repository. But not everyone has moved and for someone, the problem is still relevant.</p><blockquote><p>A <strong>CDN</strong> is a <strong>Content Delivery Network</strong> - what this means for <strong>CocoaPods</strong> is that using <strong>CocoaPods</strong> won't require you to have a local copy of all the public <strong>Podspecs</strong> on your computer. Saving you about a GB of file storage, and shaving a lot of time off pod installs.</p></blockquote><h2 id="superfast"><img class="reaction" src="/reactions/lightning.svg" alt="lightning.svg" title="lightning.svg"> <a href="#superfast">Superfast solution</a></h2><p>But what if we just always call all the commands in a bunch one after another? Nothing complicated and the whole solution fits in one line:</p><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> bundle install &amp;&amp; pods repo update &amp;&amp; pods install</div></code></pre><p>But the problem is that updating local repositories takes time. And it is a terrible idea always to call these commands. It lasts a few minutes for me and it is pretty slow.</p><h2 id="bug"><img class="reaction" src="/reactions/bug.svg" alt="bug.svg" title="bug.svg"> <a href="#bug">Error handling</a></h2><p>Let's handle the errors and call updating of the local repositories if needed. In the last post, we already prepared the <strong>pod_install</strong> function. So, it remains only to add processing to it.</p><p>To do this, we will use the <strong>while</strong> loop and the variable with the number of attempts. Inside the loop, call <strong>bundle exec pod install</strong> and get the command execution code. Depending on the code, we decide what to do next.</p><p>For example, if the code is <strong>7</strong>, then we call <strong>bundle install</strong>, write information about the error and its solution to the console. Then go to the next step of the loop and call <strong>bundle exec pod install</strong> again. Handle the error and so on.</p><p>As a result, we will process all errors known to us and sequentially update all local repositories if necessary.</p><pre><code class="block"><div class="line">tries=<span class="number">2</span></div><div class="line"><span class="keyword">while</span> (( $tries > <span class="number">0</span> ))</div><div class="line"><span class="keyword">do</span></div><div class="line">    <span class="method">bundle exec pod install</span> <span class="string">"$@"</span></div><div class="line">    error=<span class="call">$?</span></div><div class="line">    <span class="keyword">if</span> (( error == <span class="number">7</span> )) ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"\n⚠️ Error code: ${error}"</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"🚑 Let's try bundle install\n"</span></div><div class="line">        <span class="method">bundle install</span></div><div class="line">    <span class="keyword">elif</span> (( error == <span class="number">31</span> )) ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"\n⚠️  Error code: ${error}"</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"🚑 Let's try --repo-update\n"</span></div><div class="line">        <span class="method">bundle exec pod install --repo-update</span></div><div class="line">    <span class="keyword">elif</span> (( error != <span class="number">0</span> )) ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"\n⚠️ Error code: ${error}"</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">echo -e</span> <span class="string">"<img class="reaction" src="/reactions/party.png" alt="party.png" title="party.png"> Everything fine."</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">    tries=<span class="call">$</span>(( $tries - <span class="number">1</span> ))</div><div class="line"><span class="keyword">done</span></div></code></pre><h2 id="message"><img class="reaction" src="/reactions/loudspeaker.svg" alt="loudspeaker.svg" title="loudspeaker.svg"> <a href="#message">One more thing</a></h2><p>There remains only one small problem. When can we stop drinking coffee and watch memes? In other words, how do you know when a command will finish? Of course, you can from time to time check terminal. But it is not convenient.</p><p>It would be nice to have a notification of completion. And we will add it!</p><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> tput bel</div></code></pre><p>Just add a small command at the very end of the <strong>pods_install</strong> function. So, we will get a standard sound notification and see the unread message icon on the terminal icon.</p><img src="/posts/2020-06-06-cozy-pod-install-3/bell.png"/><h2 id="usage"><img class="reaction" src="/reactions/rocket.gif" alt="rocket.gif" title="rocket.gif"> <a href="#usage">How to use it?</a></h2><p>I shared the final version on <a href="https://gist.github.com/swiftyfinch/53c76e2faff3de83371193468380e90c">Github Gists</a>. There are combined all the code from the posts and added the commands coloring in the terminal. A little, but nice. Detailed installation instructions:</p><ul><li>Open <strong>.bash_profile</strong>;</li><li>Copy the code from <a href="https://gist.github.com/swiftyfinch/53c76e2faff3de83371193468380e90c">Github Gists</a> to <strong>.bash_profile</strong>;</li><li>Apply changes from <strong>.bash_profile</strong>;</li><li>Use <strong>pods install</strong>.</li></ul><pre><code class="terminal"><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> open -a Xcode ~/.bash_profile</div><div class="line"><span class="comment"># Copy code from Github Gists to .bash_profile</span></div><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> source ~/.bash_profile</div><div class="line"><span class="red-circle">•</span><span class="yellow-circle">•</span><span class="green-circle">•</span> pods install</div></code></pre><h2 id="end"><img class="reaction" src="/reactions/finish.svg" alt="finish.svg" title="finish.svg"> <a href="#end">The End</a></h2><p>What did we get?</p><ul><li>A small <strong>Bash</strong> wrapper over <strong>CocoaPods</strong>;</li><li>Allows you to call one short command <strong>pods install</strong> and <s>watch memes</s> switch to other important tasks;</li><li>All intermediate steps do not require your participation;</li><li>No need to periodically check terminal — a bell will notify you about completion.</li></ul><p>This is where I finish my experiments with <strong>CocoaPods</strong> and <strong>Bash</strong>. I solved my problem and was happy to share this with you. It was very interesting to work a bit with scripts and write something unusual for an iOS developer.</p><p><img class="reaction" src="/reactions/idea.svg" alt="idea.svg" title="idea.svg"> I have an idea... Perhaps there will be another post with a script on <strong>Ruby</strong>.</p><p><br></p><p>💬 Please, leave some feedback in <strong>Twitter</strong> post.<br>It will help me improve posts and continue to publish new ones.</p><blockquote class="twitter-tweet" data-lang="en" data-dnt="true"><p lang="en" dir="ltr">I&#39;ve just translated the last part: Cozy pod install<img class="reaction" src="/reactions/herb.svg" alt="herb.svg" title="herb.svg"><a href="https://twitter.com/hashtag/ios?src=hash&amp;ref_src=twsrc%5Etfw">#ios</a> <a href="https://twitter.com/hashtag/cocoapods?src=hash&amp;ref_src=twsrc%5Etfw">#cocoapods</a> <a href="https://twitter.com/hashtag/bash?src=hash&amp;ref_src=twsrc%5Etfw">#bash</a> <a href="https://twitter.com/hashtag/tools?src=hash&amp;ref_src=twsrc%5Etfw">#tools</a><a href="https://t.co/nh9RefeGMy">https://t.co/nh9RefeGMy</a> <a href="https://t.co/uvXtcWfBvQ">pic.twitter.com/uvXtcWfBvQ</a></p>&mdash; Ну Слаааава (@swiftyfinch) <a href="https://twitter.com/swiftyfinch/status/1273673851973623808?ref_src=twsrc%5Etfw">June 18, 2020</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><footer><a class="home" href="/en" title="Go Home"><img src="/reactions/home.svg"/></a><p>© 2025. All rights reserved.</p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p></footer></body></html>