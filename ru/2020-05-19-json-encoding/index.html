<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"/><meta property="og:site_name" content="Swifty Finch"/><link rel="canonical" href="https://swiftyfinch.github.io/ru/2020-05-19-json-encoding"/><meta name="twitter:url" content="https://swiftyfinch.github.io/ru/2020-05-19-json-encoding"/><meta property="og:url" content="https://swiftyfinch.github.io/ru/2020-05-19-json-encoding"/><title>Экранирование json объекта | Swifty Finch</title><meta name="twitter:title" content="Экранирование json объекта | Swifty Finch"/><meta property="og:title" content="Экранирование json объекта | Swifty Finch"/><meta name="description" content="Думаю многие работали с экранированием URL. А можете с ходу ответить экранируется ли json при отправке в body? В своей работе я столкнулся с тем, что по умолчанию json body запроса экранируется при использовании стандартного JSONEncoder. Чем это плохо спросите вы?"/><meta name="twitter:description" content="Думаю многие работали с экранированием URL. А можете с ходу ответить экранируется ли json при отправке в body? В своей работе я столкнулся с тем, что по умолчанию json body запроса экранируется при использовании стандартного JSONEncoder. Чем это плохо спросите вы?"/><meta property="og:description" content="Думаю многие работали с экранированием URL. А можете с ходу ответить экранируется ли json при отправке в body? В своей работе я столкнулся с тем, что по умолчанию json body запроса экранируется при использовании стандартного JSONEncoder. Чем это плохо спросите вы?"/><!--Yandex.Metrika counter--><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

ym(62530267, "init", {
     clickmap:true,
     trackLinks:true,
     accurateTrackBounce:true
});</script><noscript><div><img src="https://mc.yandex.ru/watch/62530267" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!--/Yandex.Metrika counter--><meta name="yandex-verification" content="57c929529030b8fd"/><meta name="google-site-verification" content="u8NFg-rSs0ZM826TWcHCMQ90RRHRjEk9SpRSbYcB1rQ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/code.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/site.webmanifest"/><meta name="twitter:image" content="https://swiftyfinch.github.io/site/avatar.png"/><meta property="og:image" content="https://swiftyfinch.github.io/site/avatar.png"/></head><body class="item-page"><header><div class="wrapper"><div class="facade"><a class="site-name" href="/ru"><img class="avatar" src="/site/avatar.png"/>Swifty Finch</a><div class="icons"><div><a class="icon" href="https://github.com/swiftyfinch"><img src="/site/networks/github.png"/></a></div><div><a class="icon" href="https://www.linkedin.com/in/vyacheslav-khorkov-92b65164"><img src="/site/networks/linkedin.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/rugby"><img src="/site/networks/rugby.png"/></a></div><div><a class="icon" href="https://github.com/swiftyfinch/xtree"><img src="/site/networks/xtree.png"/></a></div><div><a class="icon" href="https://t.me/ural_finch"><img src="/site/networks/telegram.png"/></a></div></div><nav><a href="/en/2020-05-19-json-encoding"><div>en</div></a></nav></div></div></header><div class="wrapper"><article><div class="content"><h1><p>Экранирование json объекта</p></h1><div class="tag-list"><a href="/tags/ru-ios"><div style="background-color: #efac32">ios</div></a><a href="/tags/ru-swift"><div style="background-color: #6c99bb">swift</div></a><a href="/tags/ru-tech"><div style="background-color: #7daf9c">tech</div></a></div><div class="date"><img class="date_icon" src="/reactions/calendar.svg"/><span>19.05.2020</span></div><div class="time_to_read"><img class="time_to_read_icon" src="/reactions/watch.svg"/><span class="time_to_read_text">1 мин</span></div><img src="/posts/2020-05-19-json-encoding/macbook.jpg"/><p>Думаю многие работали с экранированием <strong>URL</strong>. А можете с ходу ответить экранируется ли <strong>json</strong> при отправке в <strong>body</strong>? В своей работе я столкнулся с тем, что по умолчанию <strong>json</strong> <strong>body</strong> запроса экранируется при использовании стандартного <strong>JSONEncoder</strong>. Чем это плохо спросите вы?</p><h2 id="bug"><img class="reaction" src="/reactions/bug.svg" alt="bug.svg" title="bug.svg"> <a href="#bug">Проблема</a></h2><p>А вот представьте, что вы отправляете адрес: <strong>Трамвайный переулок 3/4</strong>. Что получим в <strong>body</strong>? Вот такую штуку: <strong>Трамвайный переулок 3&bsol;/4</strong>. И затем бедный менеджер будет декодировать этот адрес вручную (при тестировании ни один менеджер не пострадал).</p><h2 id="idea"><img class="reaction" src="/reactions/idea.svg" alt="idea.svg" title="idea.svg"> <a href="#idea">Решение</a></h2><p>Хорошая новость в том, что это можно легко исправить! У <strong>JSONEncoder</strong> есть свойство <strong>withoutEscapingSlashes</strong>.</p><p>Плохая в том, что только на <strong>iOS 13</strong>. Иначе вам придется делать это вручную. Вот пример, как это может выглядеть:</p><pre><code class="swift"><div class="line"><span class="keyword">struct</span> WithoutEscapingSlashesEncoder {</div><div class="line"></div><div class="line">    <span class="keyword">private enum</span> EncoderError: <span class="type">InternalError</span> {</div><div class="line">        <span class="keyword">case</span> dataToUTF8</div><div class="line">        <span class="keyword">case</span> utf8ToData</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">func</span> encode&lt;T: <span class="type">Encodable</span>&gt;(<span class="keyword">_</span> object: <span class="type">T</span>) <span class="keyword">throws</span> -&gt; <span class="type">Data</span> {</div><div class="line">        <span class="keyword">let</span> jsonEncoder = <span class="type">JSONEncoder</span>()</div><div class="line">        <span class="keyword">if #available</span>(iOS <span class="number">13</span>, *) {</div><div class="line">            jsonEncoder.<span class="property">outputFormatting</span> = .<span class="dotAccess">withoutEscapingSlashes</span></div><div class="line">            <span class="keyword">return try</span> jsonEncoder.<span class="call">encode</span>(object)</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> jsonEncoder.<span class="call">encode</span>(object)</div><div class="line">            <span class="keyword">guard let</span> string = <span class="type">String</span>(data: data, encoding: .<span class="dotAccess">utf8</span>)</div><div class="line">            <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="type">EncoderError</span>.<span class="property">dataToUTF8</span> }</div><div class="line"></div><div class="line">            <span class="keyword">let</span> fixedString = string.<span class="call">replacingOccurrences</span>(of: <span class="string">"\\/"</span>, with: <span class="string">"/"</span>)</div><div class="line">            <span class="keyword">guard let</span> fixedData = fixedString.<span class="call">data</span>(using: .<span class="dotAccess">utf8</span>)</div><div class="line">            <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="type">EncoderError</span>.<span class="property">utf8ToData</span> }</div><div class="line">            <span class="keyword">return</span> fixedData</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></code></pre><p>Вы можете оставить свой фидбек <a href="https://twitter.com/swiftyfinch/status/1262754511916953602?s=20">в этом твите</a> <img class="reaction" src="/reactions/edit.svg" alt="edit.svg" title="edit.svg">.</p></div></article></div><footer><a class="home" href="/ru" title="Go Home"><img src="/reactions/home.svg"/></a><p>© 2025. All rights reserved.</p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p></footer></body></html>