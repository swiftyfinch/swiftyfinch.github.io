<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swifty Finch"/><link rel="canonical" href="https://swiftyfinch.github.io/posts/2020-05-19-json-encoding"/><meta name="twitter:url" content="https://swiftyfinch.github.io/posts/2020-05-19-json-encoding"/><meta name="og:url" content="https://swiftyfinch.github.io/posts/2020-05-19-json-encoding"/><title>–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ json –æ–±—ä–µ–∫—Ç–∞ | Swifty Finch</title><meta name="twitter:title" content="–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ json –æ–±—ä–µ–∫—Ç–∞ | Swifty Finch"/><meta name="og:title" content="–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ json –æ–±—ä–µ–∫—Ç–∞ | Swifty Finch"/><meta name="description" content="–î—É–º–∞—é –º–Ω–æ–≥–∏–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º¬†URL. –ê –º–æ–∂–µ—Ç–µ —Å —Ö–æ–¥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏¬†json¬†–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤¬†body? –í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ —è —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å —Ç–µ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬†json body¬†–∑–∞–ø—Ä–æ—Å–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ¬†JSONEncoder. –ß–µ–º —ç—Ç–æ –ø–ª–æ—Ö–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã?"/><meta name="twitter:description" content="–î—É–º–∞—é –º–Ω–æ–≥–∏–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º¬†URL. –ê –º–æ–∂–µ—Ç–µ —Å —Ö–æ–¥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏¬†json¬†–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤¬†body? –í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ —è —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å —Ç–µ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬†json body¬†–∑–∞–ø—Ä–æ—Å–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ¬†JSONEncoder. –ß–µ–º —ç—Ç–æ –ø–ª–æ—Ö–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã?"/><meta name="og:description" content="–î—É–º–∞—é –º–Ω–æ–≥–∏–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º¬†URL. –ê –º–æ–∂–µ—Ç–µ —Å —Ö–æ–¥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏¬†json¬†–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤¬†body? –í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ —è —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å —Ç–µ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬†json body¬†–∑–∞–ø—Ä–æ—Å–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ¬†JSONEncoder. –ß–µ–º —ç—Ç–æ –ø–ª–æ—Ö–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã?"/><!--Yandex.Metrika counter--><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

ym(62530267, "init", {
     clickmap:true,
     trackLinks:true,
     accurateTrackBounce:true
});</script><noscript><div><img src="https://mc.yandex.ru/watch/62530267" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!--/Yandex.Metrika counter--><meta name="yandex-verification" content="57c929529030b8fd"/><meta name="google-site-verification" content="u8NFg-rSs0ZM826TWcHCMQ90RRHRjEk9SpRSbYcB1rQ"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/code.css" type="text/css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neucha:400,400italic,700|Abril+Fatface" type="text/css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700|Abril+Fatface" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"/><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link rel="manifest" href="/site.webmanifest"/><meta name="twitter:image" content="https://swiftyfinch.github.io/site/avatar.png"/><meta name="og:image" content="https://swiftyfinch.github.io/site/avatar.png"/></head><body class="item-page"><header><div class="wrapper"><div class="facade"><a class="site-name" href="/"><img class="avatar" src="/site/avatar.png"/>Swifty Finch</a><div class="icons"><div><a class="icon" href="https://www.instagram.com/swiftyfinch"><img src="/site/networks/instagram_bw.png"/></a></div><div><a class="icon" href="https://twitter.com/swiftyfinch"><img src="/site/networks/twitter_bw.png"/></a></div><div><a class="icon" href="https://medium.com/@swiftyfinch"><img src="/site/networks/medium_bw.png"/></a></div><div><a class="icon" href="https://github.com/artFintch"><img src="/site/networks/github_bw.png"/></a></div><div><a class="icon" href="https://ekaterinburg.hh.ru/applicant/resumes/view?resume=227c8eb0ff013a445d0039ed1f395a436a494a"><img src="/site/networks/hh_bw.png"/></a></div><div><a class="icon" href="https://www.linkedin.com/in/vyacheslav-khorkov-92b65164"><img src="/site/networks/linkedin_bw.png"/></a></div><div><a class="icon" href="https://www.upwork.com/o/profiles/users/_~01379889e9ed58198c"><img src="/site/networks/upwork_bw.png"/></a></div></div></div></div></header><div class="wrapper"><article><div class="content"><h1>–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ json –æ–±—ä–µ–∫—Ç–∞</h1><ul class="tag-list"><li style="background-color: #efac32"><a href="/tags/ios">ios</a></li><li style="background-color: #6c99bb"><a href="/tags/swift">swift</a></li><li style="background-color: #7daf9c"><a href="/tags/tech">tech</a></li></ul><div class="date"><img class="date_icon" src="/reactions/calendar.svg"/><span>19.05.2020</span></div><div class="time_to_read"><img class="time_to_read_icon" src="/reactions/watch.svg"/><span class="time_to_read_text">1 –º–∏–Ω</span></div><img src="/posts/2020-05-19-json-encoding/macbook.jpg"/><p>–î—É–º–∞—é –º–Ω–æ–≥–∏–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º¬†<strong>URL</strong>. –ê –º–æ–∂–µ—Ç–µ —Å —Ö–æ–¥—É –æ—Ç–≤–µ—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏¬†<strong>json</strong>¬†–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤¬†<strong>body</strong>? –í —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ —è —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å —Ç–µ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬†<strong>json</strong> <strong>body</strong>¬†–∑–∞–ø—Ä–æ—Å–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ¬†<strong>JSONEncoder</strong>. –ß–µ–º —ç—Ç–æ –ø–ª–æ—Ö–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã?</p><p>–ê –≤–æ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∞–¥—Ä–µ—Å:¬†<strong>–¢—Ä–∞–º–≤–∞–π–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫ 3/4</strong>. –ß—Ç–æ –ø–æ–ª—É—á–∏–º –≤¬†<strong>body</strong>? –í–æ—Ç —Ç–∞–∫—É—é —à—Ç—É–∫—É:¬†<strong>–¢—Ä–∞–º–≤–∞–π–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫ 3&bsol;/4</strong>. –ò –∑–∞—Ç–µ–º –±–µ–¥–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –±—É–¥–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é (–ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∏ –æ–¥–∏–Ω –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª).</p><p>–•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å –≤ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å! –£¬†<strong>JSONEncoder</strong>¬†–µ—Å—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ¬†<strong>withoutEscapingSlashes</strong>.</p><p>–ü–ª–æ—Ö–∞—è –≤ —Ç–æ–º, —á—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞¬†<strong>iOS 13</strong>. –ò–Ω–∞—á–µ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤—Ä—É—á–Ω—É—é. –í–æ—Ç –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å:</p><pre><code><span class="keyword">struct</span> WithoutEscapingSlashesEncoder {

    <span class="keyword">private enum</span> EncoderError: <span class="type">InternalError</span> {
        <span class="keyword">case</span> dataToUTF8
        <span class="keyword">case</span> utf8ToData
    }

    <span class="keyword">func</span> encode&lt;T: <span class="type">Encodable</span>&gt;(<span class="keyword">_</span> object: <span class="type">T</span>) <span class="keyword">throws</span> -&gt; <span class="type">Data</span> {
        <span class="keyword">let</span> jsonEncoder = <span class="type">JSONEncoder</span>()
        <span class="keyword">if #available</span>(iOS <span class="number">13</span>, *) {
            jsonEncoder.<span class="property">outputFormatting</span> = .<span class="dotAccess">withoutEscapingSlashes</span>
            <span class="keyword">return try</span> jsonEncoder.<span class="call">encode</span>(object)
        } <span class="keyword">else</span> {
            <span class="keyword">let</span> data = <span class="keyword">try</span> jsonEncoder.<span class="call">encode</span>(object)
            <span class="keyword">guard let</span> string = <span class="type">String</span>(data: data, encoding: .<span class="dotAccess">utf8</span>)
            <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="type">EncoderError</span>.<span class="property">dataToUTF8</span> }

            <span class="keyword">let</span> fixedString = string.<span class="call">replacingOccurrences</span>(of: <span class="string">"\\/"</span>, with: <span class="string">"/"</span>)
            <span class="keyword">guard let</span> fixedData = fixedString.<span class="call">data</span>(using: .<span class="dotAccess">utf8</span>)
            <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="type">EncoderError</span>.<span class="property">utf8ToData</span> }
            <span class="keyword">return</span> fixedData
        }
    }
}
</code></pre><p>–í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π —Ñ–∏–¥–±–µ–∫ <a href="https://twitter.com/swiftyfinch/status/1262754511916953602?s=20">–≤ —ç—Ç–æ–º —Ç–≤–∏—Ç–µ</a> üìù.</p></div></article></div><footer><a class="home" href="/" title="Go Home">üè°</a><p>¬© 2020. All rights reserved.</p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p></footer></body></html>